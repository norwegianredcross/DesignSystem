import{j as P}from"./jsx-runtime-D_zvdyIk.js";import{a as D,c as B,o as O,f as q,s as F}from"./floating-ui.dom-D8S3B1vO.js";import{u as K}from"./floating-ui.react-VFS6-CKd.js";import{S as T}from"./index-Cb-ENzfG.js";import{c as U}from"./lite-DaUVFjkg.js";import{r as o}from"./index-D4lIrffr.js";import{B as W}from"./Button-_80U_wOV.js";const k=({children:a})=>{const s=o.useId(),[t,r]=o.useState(s);return P.jsx(w.Provider,{value:{popoverId:t,setPopoverId:r},children:a})};k.displayName="PopoverTriggerContext";const w=o.createContext({}),X=o.forwardRef(function({id:s,className:t,onClose:r,onOpen:n,open:i,variant:v="default",placement:l="top",autoPlacement:m=!0,asChild:j=!1,...R},S){const I=j?T:"div",x=o.useRef(null),M=K([x,S]),{popoverId:C,setPopoverId:h}=o.useContext(w),[L,y]=o.useState(!1),g=i??L;return o.useEffect(()=>{var p;const e=x.current,c=u=>{var E;const d=u.target,b=(E=d==null?void 0:d.closest)==null?void 0:E.call(d,`[popovertarget="${e==null?void 0:e.id}"]`),N=!b&&!(e!=null&&e.contains(d));b&&(u.preventDefault(),y(A=>!A),n==null||n()),N&&(y(!1),r==null||r())},f=u=>{u.key!=="Escape"||!g||(u.preventDefault(),y(!1),r==null||r())};return(p=e==null?void 0:e.togglePopover)==null||p.call(e,g),document.addEventListener("click",c,!0),document.addEventListener("keydown",f),()=>{document.removeEventListener("click",c,!0),document.removeEventListener("keydown",f)}},[g]),o.useEffect(()=>{const e=x.current,c=document.querySelector(`[popovertarget="${e==null?void 0:e.id}"]`);if(e&&c&&g)return D(c,e,()=>{B(c,e,{placement:l,strategy:"fixed",middleware:[O(f=>{const p=getComputedStyle(f.elements.floating,"::before");return parseFloat(p.height)}),...m?[q({fallbackAxisSideDirection:"start"}),F()]:[],Y]}).then(({x:f,y:p})=>{e.style.translate=`${f}px ${p}px`})})},[g,l,s,m]),o.useEffect(()=>{s&&(h==null||h(s))},[s]),P.jsx(I,{className:U("ds-popover",t),id:s||C,popover:"manual","data-variant":v,ref:M,...R})}),Y={name:"ArrowPseudoElement",fn(a){const{elements:s,rects:t,placement:r}=a;let n=`${Math.round(t.reference.width/2+t.reference.x-a.x)}px`,i=`${Math.round(t.reference.height/2+t.reference.y-a.y)}px`;switch(t.reference.width>t.floating.width&&(n=`${Math.round(t.floating.width/2)}px`),t.reference.height>t.floating.height&&(i=`${Math.round(t.floating.height/2)}px`),r.split("-")[0]){case"top":i="100%";break;case"right":n="0";break;case"bottom":i="0";break;case"left":n="100%";break}return s.floating.setAttribute("data-placement",r.split("-")[0]),s.floating.style.setProperty("--ds-popover-arrow-x",n),s.floating.style.setProperty("--ds-popover-arrow-y",i),a}},z=o.forwardRef(function({id:s,inline:t,asChild:r,...n},i){const{popoverId:v}=o.useContext(w),l=r?T:t?"button":W,m=Object.assign({[o.version.startsWith("19")?"popoverTarget":"popovertarget"]:v,...t?{"data-popover":"inline"}:{}},n);return P.jsx(l,{ref:i,...m})}),$=Object.assign(X,{TriggerContext:k,Trigger:z});$.TriggerContext.displayName="Popover.TriggerContext";$.Trigger.displayName="Popover.Trigger";export{$ as P,z as a,k as b};
