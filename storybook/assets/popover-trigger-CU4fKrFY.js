import{r as o,j as y}from"./iframe-NSlXxCFF.js";import{a as D,c as B,o as N,f as q,s as C}from"./floating-ui.dom-BOb7AeKv.js";import{S as $}from"./index-fxYSzXt9.js";import{c as F}from"./lite-DaUVFjkg.js";import{u as K}from"./use-merge-refs-tYagDv3b.js";import{B as O}from"./button-B40UWaKO.js";const U=({children:a})=>{const s=o.useId(),[t,r]=o.useState(s);return y.jsx(P.Provider,{value:{popoverId:t,setPopoverId:r},children:a})};U.displayName="PopoverTriggerContext";const P=o.createContext({}),Q=o.forwardRef(function({id:s,className:t,onClose:r,onOpen:n,open:i,variant:h="default",placement:g="top",autoPlacement:m=!0,asChild:R=!1,...S},j){const I=R?$:"div",v=o.useRef(null),T=K([v,j]),{popoverId:M,setPopoverId:x}=o.useContext(P),[E,w]=o.useState(!1),d=i??E;return o.useEffect(()=>{var p;const e=v.current,c=l=>{var k;const u=l.target,b=(k=u==null?void 0:u.closest)==null?void 0:k.call(u,`[popovertarget="${e==null?void 0:e.id}"]`),L=!b&&!(e!=null&&e.contains(u));b&&(l.preventDefault(),w(A=>!A),n==null||n()),L&&E&&(w(!1),r==null||r())},f=l=>{l.key!=="Escape"||!d||(l.preventDefault(),w(!1),r==null||r())};return(p=e==null?void 0:e.togglePopover)==null||p.call(e,d),document.addEventListener("click",c,!0),document.addEventListener("keydown",f),()=>{document.removeEventListener("click",c,!0),document.removeEventListener("keydown",f)}},[d]),o.useEffect(()=>{const e=v.current,c=document.querySelector(`[popovertarget="${e==null?void 0:e.id}"]`);if(e&&c&&d)return D(c,e,()=>{B(c,e,{placement:g,strategy:"fixed",middleware:[N(f=>{const p=getComputedStyle(f.elements.floating,"::before");return parseFloat(p.height)}),...m?[q({fallbackAxisSideDirection:"start"}),C()]:[],W]}).then(({x:f,y:p})=>{e.style.translate=`${f}px ${p}px`})})},[d,g,s,m]),o.useEffect(()=>{s&&(x==null||x(s))},[s]),y.jsx(I,{className:F("ds-popover",t),id:s||M,popover:"manual","data-variant":h,ref:T,...S})}),W={name:"ArrowPseudoElement",fn(a){const{elements:s,rects:t,placement:r}=a;let n=`${Math.round(t.reference.width/2+t.reference.x-a.x)}px`,i=`${Math.round(t.reference.height/2+t.reference.y-a.y)}px`;switch(t.reference.width>t.floating.width&&(n=`${Math.round(t.floating.width/2)}px`),t.reference.height>t.floating.height&&(i=`${Math.round(t.floating.height/2)}px`),r.split("-")[0]){case"top":i="100%";break;case"right":n="0";break;case"bottom":i="0";break;case"left":n="100%";break}return s.floating.setAttribute("data-placement",r.split("-")[0]),s.floating.style.setProperty("--ds-popover-arrow-x",n),s.floating.style.setProperty("--ds-popover-arrow-y",i),a}},V=o.forwardRef(function({id:s,inline:t,asChild:r,...n},i){const{popoverId:h}=o.useContext(P),g=r?$:t?"button":O,m=Object.assign({[o.version.startsWith("19")?"popoverTarget":"popovertarget"]:h,...t?{"data-popover":"inline"}:{}},n);return y.jsx(g,{ref:i,...m})});export{Q as P,V as a,U as b};
